{"version":3,"sources":["../../../src/local/table/tabulator-entity-lookup.js"],"names":["entityLookup","entityclass","displayfield","LOOKUP_CACHE","Promise","race","methodname","args","catch","Notification","exception","then","result","warnings","length","addNotification","message","reduce","a","w","JSON","parse","values"],"mappings":"uMAuBA,uDAKO,QAASA,CAAAA,CAAT,CAAsBC,CAAtB,CAAmCC,CAAnC,CAAiD,CACpD,GAAI,CAACF,CAAY,CAACG,YAAb,CAA0BF,CAA1B,CAAL,CAA6C,CACzCD,CAAY,CAACG,YAAb,CAA0BF,CAA1B,EAAyC,EAC5C,CAED,GAAID,CAAY,CAACG,YAAb,CAA0BF,CAA1B,GACGD,CAAY,CAACG,YAAb,CAA0BF,CAA1B,EAAuCC,CAAvC,CADP,CAC6D,CACzD,MAAOF,CAAAA,CAAY,CAACG,YAAb,CAA0BF,CAA1B,EAAuCC,CAAvC,CACV,CACD,MAAOE,CAAAA,OAAO,CAACC,IAAR,CACH,WACI,CAAC,CACGC,UAAU,CAAE,uBADf,CAEGC,IAAI,CAAE,CACFN,WAAW,CAAEA,CADX,CAEFC,YAAY,CAAEA,CAFZ,CAFT,CAAD,CADJ,CADG,EASAM,KATA,CASMC,UAAaC,SATnB,EAUFC,IAVE,CAWC,SAACC,CAAD,CAAY,CACR,GAAIA,CAAM,CAACC,QAAP,EAA8C,CAA3B,GAAAD,CAAM,CAACC,QAAP,CAAgBC,MAAvC,CAAqD,CACjDL,UAAaM,eAAb,CACI,CACIC,OAAO,CAAEJ,CAAM,CAACC,QAAP,CAAgBI,MAAhB,CAAuB,SAACC,CAAD,CAAIC,CAAJ,QAAWD,CAAAA,CAAC,CAAG,GAAJ,CAAUC,CAArB,CAAvB,CAAgD,EAAhD,CADb,CADJ,EAKA,MAAO,EACV,CACDnB,CAAY,CAACG,YAAb,CAA0BF,CAA1B,EAAuCC,CAAvC,EAAuDkB,IAAI,CAACC,KAAL,CAAWT,CAAM,CAACU,MAAlB,CAAvD,CACA,MAAOtB,CAAAA,CAAY,CAACG,YAAb,CAA0BF,CAA1B,EAAuCC,CAAvC,CACV,CAtBF,CAuBV,CAEDF,CAAY,CAACG,YAAb,CAA4B,E","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n * AMD module to store the entity lookup values\n *\n * @module   local_cltools/table/tabulator-entity-lookup.js\n * @copyright 2021 - CALL Learning - Laurent David <laurent@call-learning.fr>\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {call as ajaxCall} from \"core/ajax\";\nimport Notification from 'core/notification';\n/**\n *\n * @param formatterParams\n */\nexport function entityLookup(entityclass, displayfield) {\n    if (!entityLookup.LOOKUP_CACHE[entityclass]) {\n        entityLookup.LOOKUP_CACHE[entityclass] = [];\n    }\n\n    if (entityLookup.LOOKUP_CACHE[entityclass]\n        && entityLookup.LOOKUP_CACHE[entityclass][displayfield]) {\n        return entityLookup.LOOKUP_CACHE[entityclass][displayfield];\n    }\n    return Promise.race(\n        ajaxCall(\n            [{\n                methodname: 'cltools_entity_lookup',\n                args: {\n                    entityclass: entityclass,\n                    displayfield: displayfield,\n                }\n            }]\n        )).catch(Notification.exception)\n        .then(\n            (result) => {\n                if (result.warnings && result.warnings.length !== 0) {\n                    Notification.addNotification(\n                        {\n                            message: result.warnings.reduce((a, w) => (a + ',' + w), '')\n                        }\n                    );\n                    return [];\n                }\n                entityLookup.LOOKUP_CACHE[entityclass][displayfield] = JSON.parse(result.values);\n                return entityLookup.LOOKUP_CACHE[entityclass][displayfield];\n            });\n}\n\nentityLookup.LOOKUP_CACHE = [];\n"],"file":"tabulator-entity-lookup.min.js"}