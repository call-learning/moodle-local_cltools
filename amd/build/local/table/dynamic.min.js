define ("local_cltools/local/table/dynamic",["exports","local_cltools/local/table/tabulator-lazy","local_cltools/local/moment-lazy","jquery","core/ajax","core/notification","core/str"],function(a,b,c,d,e,f,g){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;b=h(b);c=h(c);d=h(d);f=h(f);function h(a){return a&&a.__esModule?a:{default:a}}function i(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){c(a);return}if(h.done){b(i)}else{Promise.resolve(i).then(d,e)}}function j(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){var h=a.apply(b,c);function f(a){i(h,d,e,f,g,"next",a)}function g(a){i(h,d,e,f,g,"throw",a)}f(void 0)})}}var k={select_choice:{to:"lookup",transformer:function transformer(a){return a.choices}},entity_selector:{to:"lookup",transformer:function transformer(a){return a.choices}},datetime:{to:"datetime",transformer:function transformer(a){return{outputFormat:a.inputformat,inputFormat:a.inputformat,timezone:a.timezone}}}},l=function(a,b,d){var f=document.createElement("input");f.setAttribute("type","date");f.style.padding="3px";f.style.width="100%";f.style.boxSizing="border-box";f.value=(0,c.default)(a.getValue(),"DD/MM/YYYY").format("YYYY-MM-DD");b(function(){f.focus();f.style.css="100%"});function e(){d((0,c.default)(f.value,"YYYY-MM-DD").format("DD/MM/YYYY"))}f.addEventListener("change",e);f.addEventListener("blur",e);return f},m={text:{to:"input"},select_choice:{to:"select",transformer:function transformer(a){return{values:a.choices}}},entity_selector:{to:"select",transformer:function transformer(a){return{values:a.choices}}},datetime:{to:"datetime",transformer:function transformer(a){return{outputFormat:a.inputformat,inputFormat:a.inputformat,timezone:a.timezone}},editor:l}},n=function(a){return a.map(function(a){var b="formatterparams"in a?JSON.parse(a.formatterparams):null,c="filterparams"in a?JSON.parse(a.filterparams):null;if(!b){delete a.formatterparams}if(!c){delete a.filterparams}if("formatter"in a&&a.formatter in k){var d=k[a.formatter];if(b){a.formatterParams=d.transformer(b)}a.formatter=d.to}if("filter"in a&&a.filter in m){var e=m[a.filter];if(c){a.headerFilterParams=e.transformer(c)}a.headerFilter=e.to;if("editor"in e){a.editor=e.editor}}return a})},o={input:{to:"string_filter"},like:{to:"numeric_comparison_filter",transformer:function transformer(a){return[JSON.stringify({direction:"=",value:a})]}}},p=function(a,b,c,d){var g={handler:a,uniqueid:b,sortdata:"undefined"==typeof d.sorters?[]:d.sorters.map(function(a){return{sortby:a.field,sortorder:a.dir.toUpperCase()}}),filters:"undefined"==typeof d.filters?[]:d.filters.map(function(a){var b={name:a.field,type:a.type,jointype:1,values:a.value};if(a.type in o){var c=o[a.type];b.type=c.to;if("undefined"!=typeof c.transformer){b.values=c.transformer(a.value)}}return b}),jointype:1,pagenumber:d.page,pagesize:c,hiddencolumns:[],resetpreferences:!1,firstinitial:"A",lastinitial:"Z"};return Promise.race((0,e.call)([{methodname:"cltools_dynamic_table_get_rows",args:g}])).catch(f.default.exception)},q=function(a,b,c){c.data=c.data.map(function(a){return JSON.parse(a)});return c},r=function(){var a=j(regeneratorRuntime.mark(function a(h){var i,j,k;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:if("undefined"==typeof window.moment){window.moment=c.default}i=(0,d.default)("#"+h);a.next=4;return(0,g.get_string)("table:nodata","local_cltools");case 4:j=a.sent;a.next=7;return Promise.race((0,e.call)([{methodname:"cltools_dynamic_table_get_columns",args:{handler:i.data("tableHandler"),uniqueid:i.data("tableUniqueid")}}])).catch(f.default.exception);case 7:k=a.sent;new b.default("#"+h,{ajaxRequestFunc:function ajaxRequestFunc(a,b,c){var d=i.data("tableHandler"),e=i.data("tableUniqueid"),f=this.table.getPageSize();return p(d,e,f,c)},ajaxURL:!0,pagination:"remote",paginationSize:i.data("table-pagesize"),ajaxFiltering:!0,ajaxSorting:!0,paginationDataReceived:{last_page:"pagescount"},ajaxResponse:q,columns:n(k),layout:"fitColumns",placeholder:j});case 9:case"end":return a.stop();}}},a)}));return function(){return a.apply(this,arguments)}}();a.init=r});
//# sourceMappingURL=dynamic.min.js.map
