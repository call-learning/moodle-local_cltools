{"version":3,"sources":["../../../src/local/table/moodle-filter-converters.js"],"names":["toNumericEqual","val","JSON","stringify","direction","value","MOODLE_FILTER_CONVERTER","to","transformer","args","Array","isArray","map","convertInitialFilter","initialFilters","existingFilters","joinType","jointype","prototype","push","apply","Object","values","filters","convertFiltersToMoodle","tabulatorFilters","e","filter","field","type","converter"],"mappings":"2OAwBMA,CAAAA,CAAc,CAAG,SAACC,CAAD,QAASC,CAAAA,IAAI,CAACC,SAAL,CAAe,CAC3CC,SAAS,CAAE,GADgC,CAE3CC,KAAK,CAAEJ,CAFoC,CAAf,CAAT,C,CAKjBK,CAAuB,CAAG,CAC5B,KAAQ,CACJC,EAAE,CAAE,eADA,CAEJC,WAAW,CAAE,qBAACC,CAAD,CAAU,CACnB,MAAO,CAACJ,KAAK,CAAEI,CAAR,CACV,CAJG,CADoB,CAO5B,IAAK,CACDF,EAAE,CAAE,2BADH,CAEDC,WAAW,CAAE,qBAACC,CAAD,CAAU,CACnB,GAAIC,KAAK,CAACC,OAAN,CAAcF,CAAd,CAAJ,CAAyB,CACrB,MAAOA,CAAAA,CAAI,CAACG,GAAL,CAASZ,CAAT,CACV,CAFD,IAEO,IAAoB,SAAhB,QAAOS,CAAAA,CAAX,CAA+B,CAClC,MAAO,CAACT,CAAc,CAACS,CAAI,CAAG,CAAH,CAAM,CAAX,CAAf,CACV,CAFM,IAEA,CACH,MAAO,CAACT,CAAc,CAACS,CAAD,CAAf,CACV,CACJ,CAVA,CAPuB,C,gBAqBJ,C,yCAGQ,QAAvBI,CAAAA,oBAAuB,CAACC,CAAD,CAAiBC,CAAjB,CAAqC,CACrE,GAAMC,CAAAA,CAAQ,CAAGF,CAAc,CAAGA,CAAc,CAACG,QAAlB,EAA/B,CACA,GAAIH,CAAJ,CAAoB,CAEhBJ,KAAK,CAACQ,SAAN,CAAgBC,IAAhB,CAAqBC,KAArB,CAA2BL,CAA3B,CAA4CM,MAAM,CAACC,MAAP,CAAcR,CAAc,CAACS,OAA7B,CAA5C,CACH,CACD,MAAO,CAACP,CAAD,CAAWD,CAAX,CACV,C,0BAEqC,QAAzBS,CAAAA,sBAAyB,CAACC,CAAD,CAAsB,CACxD,MAAoC,WAA5B,QAAOA,CAAAA,CAAR,CAA4C,EAA5C,CAAiDA,CAAgB,CAACb,GAAjB,CACpD,SAACc,CAAD,CAAO,CACH,GAAIC,CAAAA,CAAM,CAAG,CACT,KAAQD,CAAC,CAACE,KADD,CACQ,KAAQF,CAAC,CAACG,IADlB,CACwB,UADxB,CACkD,OAAUH,CAAC,CAACrB,KAD9D,CAAb,CAGA,GAAIqB,CAAC,CAACG,IAAF,GAAUvB,CAAAA,CAAd,CAAuC,CACnC,GAAMwB,CAAAA,CAAS,CAAGxB,CAAuB,CAACoB,CAAC,CAACG,IAAH,CAAzC,CACAF,CAAM,CAACE,IAAP,CAAcC,CAAS,CAACvB,EAAxB,CACA,GAAqC,WAAjC,QAAOuB,CAAAA,CAAS,CAACtB,WAArB,CAAkD,CAC9CmB,CAAM,CAACL,MAAP,CAAgBQ,CAAS,CAACtB,WAAV,CAAsBkB,CAAC,CAACrB,KAAxB,CACnB,CACJ,CACD,MAAOsB,CAAAA,CACV,CAbmD,CAe3D,C","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AMD module to convert between Moodle filters and Tabulator filters.\n *\n * @module   local_cltools/table/dynamic.js\n * @copyright 2021 - CALL Learning - Laurent David <laurent@call-learning.fr>\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n\nconst toNumericEqual = (val) => JSON.stringify({\n    direction: '=',\n    value: val,\n});\n\nconst MOODLE_FILTER_CONVERTER = {\n    'like': {\n        to: 'string_filter',\n        transformer: (args) => {\n            return {value: args};\n        }\n    },\n    '=': {\n        to: 'numeric_comparison_filter',\n        transformer: (args) => {\n            if (Array.isArray(args)) {\n                return args.map(toNumericEqual);\n            } else if (typeof args === 'boolean') {\n                return [toNumericEqual(args ? 1: 0)];\n            } else {\n                return [toNumericEqual(args)];\n            }\n        }\n    }\n};\n\nexport const JOINTYPE_ANY = 1;\nexport const JOINTYPE_ALL = 2;\n\nexport const convertInitialFilter = (initialFilters, existingFilters) => {\n    const joinType = initialFilters ? initialFilters.jointype : JOINTYPE_ALL;\n    if (initialFilters) {\n        // Add initial filters to filters.\n        Array.prototype.push.apply(existingFilters, Object.values(initialFilters.filters));\n    }\n    return [joinType, existingFilters];\n};\n\nexport const convertFiltersToMoodle = (tabulatorFilters) => {\n    return (typeof tabulatorFilters === \"undefined\") ? [] : tabulatorFilters.map(\n        (e) => {\n            let filter = {\n                'name': e.field, 'type': e.type, 'jointype': JOINTYPE_ALL, 'values': e.value\n            };\n            if (e.type in MOODLE_FILTER_CONVERTER) {\n                const converter = MOODLE_FILTER_CONVERTER[e.type];\n                filter.type = converter.to;\n                if (typeof converter.transformer !== \"undefined\") {\n                    filter.values = converter.transformer(e.value);\n                }\n            }\n            return filter;\n        }\n    );\n};\n"],"file":"moodle-filter-converters.min.js"}