define("local_cltools/local/table/tabulator-entity-lookup",["exports","core/notification","./repository"],(function(_exports,_notification,_repository){var obj;
/**
   * AMD module to store the entity lookup values
   *
   * @module   local_cltools/table/tabulator-entity-lookup.js
   * @copyright 2021 - CALL Learning - Laurent David <laurent@call-learning.fr>
   * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.prepareEntityLookup=_exports.entityLookup=void 0,_notification=(obj=_notification)&&obj.__esModule?obj:{default:obj};const computePrefix=(entityclass,displayfield)=>"entityLookup_"+entityclass+"_"+displayfield;_exports.entityLookup=(entityclass,displayfield)=>{const values=sessionStorage.getItem(computePrefix(entityclass,displayfield));return values?JSON.parse(values):[]};_exports.prepareEntityLookup=async(entityclass,displayfield)=>{window.onbeforeunload=()=>{sessionStorage.removeItem(computePrefix(entityclass,displayfield))};const lookupValues=await(0,_repository.entityTableLookup)({entityclass:entityclass,displayfield:displayfield}).catch(_notification.default.exception).then((result=>result.warnings&&0!==result.warnings.length?(_notification.default.addNotification({message:result.warnings.reduce(((a,w)=>a+" "+w.message),"")}),[]):Object.fromEntries(result.values.map((_ref=>{let{id:id,value:value}=_ref;return[id,value]})))));sessionStorage.setItem(computePrefix(entityclass,displayfield),JSON.stringify(lookupValues))}}));

//# sourceMappingURL=tabulator-entity-lookup.min.js.map