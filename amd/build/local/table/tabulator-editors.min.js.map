{"version":3,"sources":["../../../src/local/table/tabulator-editors.js"],"names":["dateEditor","cell","onRendered","success","editor","document","createElement","setAttribute","style","padding","width","boxSizing","value","getValue","format","focus","css","successFunc","addEventListener","date","cancel","editorParams","select","entityclass","displayfield"],"mappings":"sPAqBA,uDAWO,GAAMA,CAAAA,CAAU,CAAG,SAACC,CAAD,CAAOC,CAAP,CAAmBC,CAAnB,CAA+B,CAErD,GAAIC,CAAAA,CAAM,CAAGC,QAAQ,CAACC,aAAT,CAAuB,OAAvB,CAAb,CAEAF,CAAM,CAACG,YAAP,CAAoB,MAApB,CAA4B,MAA5B,EAGAH,CAAM,CAACI,KAAP,CAAaC,OAAb,CAAuB,KAAvB,CACAL,CAAM,CAACI,KAAP,CAAaE,KAAb,CAAqB,MAArB,CACAN,CAAM,CAACI,KAAP,CAAaG,SAAb,CAAyB,YAAzB,CAGAP,CAAM,CAACQ,KAAP,CAAe,cAAOX,CAAI,CAACY,QAAL,EAAP,CAAwB,YAAxB,EAAsCC,MAAtC,CAA6C,YAA7C,CAAf,CAGAZ,CAAU,CAAC,UAAY,CACnBE,CAAM,CAACW,KAAP,GACAX,CAAM,CAACI,KAAP,CAAaQ,GAAb,CAAmB,MACtB,CAHS,CAAV,CAMA,QAASC,CAAAA,CAAT,EAAuB,CACnBd,CAAO,CAAC,cAAOC,CAAM,CAACQ,KAAd,CAAqB,YAArB,EAAmCE,MAAnC,CAA0C,YAA1C,CAAD,CACV,CAEDV,CAAM,CAACc,gBAAP,CAAwB,QAAxB,CAAkCD,CAAlC,EACAb,CAAM,CAACc,gBAAP,CAAwB,MAAxB,CAAgCD,CAAhC,EAGA,MAAOb,CAAAA,CACV,CA9BM,C,mCAqC0B,CAC7Be,IAAI,CAAEnB,CADuB,CAE7B,cAAiB,uBAACC,CAAD,CAAOC,CAAP,CAAmBC,CAAnB,CAA4BiB,CAA5B,CAAoCC,CAApC,CAAqD,CAClE,MAAO,SAAKjB,MAAL,CAAYkB,MAAZ,CAAmBrB,CAAnB,CAAyBC,CAAzB,CAAqCC,CAArC,CAA8CiB,CAA9C,CACH,mBAAaC,CAAY,CAACE,WAA1B,CAAuCF,CAAY,CAACG,YAApD,CADG,CAEV,CAL4B,C","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/**\n * AMD module defining new Tabulator formatters\n *\n * @module   local_cltools/table/tabulator-formatter.js\n * @copyright 2021 - CALL Learning - Laurent David <laurent@call-learning.fr>\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport moment from 'local_cltools/local/moment-lazy';\nimport {entityLookup} from \"./tabulator-entity-lookup\";\n\n/**\n * dateEditor\n *\n * @param cell\n * @param onRendered\n * @param success\n * @returns {HTMLInputElement}\n */\nexport const dateEditor = (cell, onRendered, success) => {\n    // Create and style editor.\n    var editor = document.createElement(\"input\");\n\n    editor.setAttribute(\"type\", \"date\");\n\n    // Create and style input\n    editor.style.padding = \"3px\";\n    editor.style.width = \"100%\";\n    editor.style.boxSizing = \"border-box\";\n\n    // Set value of editor to the current value of the cell.\n    editor.value = moment(cell.getValue(), \"DD/MM/YYYY\").format(\"YYYY-MM-DD\");\n\n    // Set focus on the select box when the editor is selected (timeout allows for editor to be added to DOM)\n    onRendered(function () {\n        editor.focus();\n        editor.style.css = \"100%\";\n    });\n\n    // When the value has been set, trigger the cell to update\n    function successFunc() {\n        success(moment(editor.value, \"YYYY-MM-DD\").format(\"DD/MM/YYYY\"));\n    }\n\n    editor.addEventListener(\"change\", successFunc);\n    editor.addEventListener(\"blur\", successFunc);\n\n    // Return the editor element\n    return editor;\n};\n\n\n/**\n * Table EDITOR\n * @type {{date: (function(*, *, *): HTMLInputElement), entity_lookup: (function(*=, *=, *=, *=, *): *)}}\n */\nexport const TABULATOR_EDITORS = {\n    date: dateEditor,\n    'entity_lookup': (cell, onRendered, success, cancel, editorParams) => {\n        return this.editor.select(cell, onRendered, success, cancel,\n            entityLookup(editorParams.entityclass, editorParams.displayfield));\n    }\n};"],"file":"tabulator-editors.min.js"}